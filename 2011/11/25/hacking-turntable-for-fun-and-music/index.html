<!DOCTYPE html>

<html itemscope="itemscope" itemtype="http://schema.org/Article"
lang="en-US">
<head>
  <meta name="generator" content=
  "HTML Tidy for HTML5 for Mac OS X version 4.9.15">
  <meta charset="UTF-8">
  <meta name="viewport" content=
  "width=device-width, initial-scale=1, maximum-scale=1">

  <title>Welcome! – Independent Publisher</title>
  <link rel="profile" href="http://gmpg.org/xfn/11">

  <link rel="alternate" type="application/rss+xml" title="Independent Publisher » Feed" href="http://independentpublisher.me/feed/">
  <link rel="alternate" type="application/rss+xml" title="Independent Publisher » Comments Feed" href="http://independentpublisher.me/comments/feed/">
  <link rel="alternate" type="application/rss+xml" title=
  "Independent Publisher » Welcome! Comments Feed" href=
  "http://independentpublisher.me/2013/welcome/feed/">
  <meta name="generator" content="Middleman">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Welcome!">
  <meta property="og:url" content=
  "http://independentpublisher.me/2013/welcome/">
  <meta property="og:description" content=
  "This site is both the official home and a demo site for the Independent Publisher project, an open source WordPress theme. New here? Start exploring: Preview the theme on this site by browsing the ...">
  <meta property="article:published_time" content=
  "2013-08-26T16:50:48+00:00">
  <meta property="article:modified_time" content=
  "2014-12-17T18:27:57+00:00">
  <meta property="article:author" content=
  "http://atamis.me">
  <meta property="og:site_name" content="Independent Publisher">
  <meta property="og:image" content=
  "https://s0.wp.com/i/blank.jpg">
  <meta name="twitter:site" content="@jetpack">
  <meta name="twitter:card" content="summary">
  <link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/independent-publisher.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
  <!--[if lt IE 9]>
  <script src="/javascripts/html5.js" type="text/javascript"></script>
  <![endif]-->
  </script>
  <script src="/javascripts/all.js" type="text/javascript"></script>
  <style>
  @-webkit-keyframes poplsuarbjuruuldilkvalgcikrxhkeeysjtt {50% {-webkit-transform:scale(1.2);}100% {-webkit-transform:scale(1);}}@keyframes poplsuarbjuruuldilkvalgcikrxhkeeysjtt {50% {-webkit-transform:scale(1.2);transform:scale(1.2);}100% {-webkit-transform:scale(1);transform:scale(1);}}#lsuarbjuruuldilkvalgcikrxhkeeysjtt{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;border:solid 2px #fff !important;box-sizing:content-box !important;color:#fff !important;display:block !important;height:auto !important;margin:0 !important;opacity:0.9 !important;padding:7px 10px !important;position:fixed !important;visibility:visible !important;width:auto !important;z-index:2147483647 !important;-webkit-border-radius:5px !important;-webkit-box-shadow:0px 0px 20px #000 !important;-webkit-box-sizing:content-box !important;}.lsuarbjuruuldilkvalgcikrxhkeeysjtt-blocked{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;color:#AAA !important;display:inline !important;text-decoration:line-through !important;}#lsuarbjuruuldilkvalgcikrxhkeeysjtt br{display:block !important;padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;}#lsuarbjuruuldilkvalgcikrxhkeeysjtt span{background:transparent !important;padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;}#lsuarbjuruuldilkvalgcikrxhkeeysjtt div{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;border:0 !important;margin:0 !important;padding:0 !important;width:auto !important;letter-spacing:normal !important;font:13px Arial,Helvetica !important;text-align:left !important;text-shadow:none !important;text-transform:none !important;word-spacing:normal !important;}#lsuarbjuruuldilkvalgcikrxhkeeysjtt a{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;font-weight:normal !important;background:none !important;text-decoration:underline !important;color:#fff !important;}a#lsuarbjuruuldilkvalgcikrxhkeeysjtt-gear{padding:0;margin:0;font:13px Arial,Helvetica;text-transform:none;font-size: 100%;vertical-align:baseline;line-height:normal;color:#fff;position:static;text-decoration:none !important;position:absolute !important;display:none !important;font-size:20px !important;width:20px !important;height:20px !important;line-height:20px !important;text-align:center !important;background-color:rgba(255,255,255,.8) !important;background-image:url(chrome-extension://mlomiejdfkolichcflejclcbmpeaniij/data/images/gear.svg) !important;background-size:16px 16px !important;background-position:center center !important;background-repeat:no-repeat !important;text-decoration:none !important;}a#lsuarbjuruuldilkvalgcikrxhkeeysjtt-gear:hover{-webkit-animation-name:poplsuarbjuruuldilkvalgcikrxhkeeysjtt !important;animation-name:poplsuarbjuruuldilkvalgcikrxhkeeysjtt !important;-webkit-animation-duration:0.3s !important;animation-duration:0.3s !important;}#lsuarbjuruuldilkvalgcikrxhkeeysjtt:hover #lsuarbjuruuldilkvalgcikrxhkeeysjtt-gear{text-decoration:none !important;display:inline-block !important;}@media print{#lsuarbjuruuldilkvalgcikrxhkeeysjtt{display:none !important;}}
  </style>
</head>

<body class=
"single single-post postid-165 single-format-standard multi-author-mode"
itemscope="itemscope" itemtype="http://schema.org/WebPage">
  <div class="site-master-logo" style="display: block;">
    <a href="/" title="Andrew Amis" rel="home">
      <span class="no-grav">AA<span>
      </a>
  </div>

  <div id="page" class="hfeed site">
    <header id="masthead" class="site-header" role="banner"
    itemscope itemtype="http://schema.org/WPHeader">
      <div class="site-header-info">
        <h1 class="site-title"><span class="byline"><span class=
        "author vcard"><a class="url fn n" href=
        "http://atamis.me" title=
        "See all articles" rel="author">Andrew Amis</a></span></span></h1>

          <h2 class="site-description">Programmer and gamer. I specialize in serverside technologies and "DevOps" tasks.</h2>

        <div id="menu-social" class="menu">
          <ul id="menu-social-items" class="menu-items">
            <li id="menu-item-278" class=
            "menu-item menu-item-type-custom menu-item-object-custom menu-item-278">
            <a href="http://twitter.com/atamiser"><span class=
            "screen-reader-text">Twitter</span></a>
            </li>

            <li id="menu-item-280" class=
            "menu-item menu-item-type-custom menu-item-object-custom menu-item-280">
            <a href=
            "http://github.com/atamis"><span class="screen-reader-text">
              GitHub</span></a>
            </li>
          </ul>
        </div>

        <div class="site-published-separator"></div>

        <h2 class="site-published-date">
          <a href="/employment/">Employment</a>
        </h2>
        <h2 class="site-published-date">
          <a href="/blog/">Blog</a>
        </h2>
      </div>
    </header>

    <div id="main" class="site-main">
      <div id="primary" class="content-area">
        <main id="content" class="site-content" role="main">
            <div class="post">
    <h2><a href="/2011/11/25/hacking-turntable-for-fun-and-music/">Hacking Turntable for Fun and Music</a> </h2>
    <span><time class="entry-date" datetime="2011-11-25 15:12:00 UTC" pubdate="pubdate">Nov 25, 2011</time></span>
    <h2 id="previous-solutions">Previous Solutions</h2>
<p><a href="http://turntable.fm">Turntable</a> is a collaborative DJ website that lets people
play music to an online audience. Turntable, by default, doesn't let you
download the music you hear. If you hover over the track name in the UI, you can
scrobble the track to Last.fm, find it in Spotify or Rdio, etc. Some people
(myself included, but we'll get to that later) wanted to download the files
being played.</p>

<p>So, a Greasemonkey script was created to automatically download songs as
they were played on Turntable. I've never tried this script because
Turntable killed it somehow. This proves that Turntable doesn't like
people messing around with their service in this way.</p>

<p>There is also the manual way. Webkit (Chrome and Safari) and Firebug
include a network activity inspector. When it's open, you can see all
the requests (and files) that the page requests. When Turntable.fm
downloads songs to play, you can see the request in the network
inspector for the music file, and it even says "audio/music" in the file
type. From there, you can get the URL for the file on Turntable (Or
MusicNet, another of Turntable's music sources), and from there you can
download the mp3. You can even download it directly from the network
inspector, but I never got that to work well.</p>

<p>So, if you want to download music from Turntable nowadays, you have to
go through an incredibly manual and annoying process filled with tedium.
At least you have music playing in the background.</p>

<p>I was not happy with this situation.</p>

<h2 id="my-solution">My Solution</h2>

<p>While walking, I considered the problem. When I was downloading the
songs from Turntable.fm, I'm looking directly (with some parsing, thanks
to Webkit or Firebug) into the HTTP stream, watching as requests and
response go by. I would get my inspector to filter for requests for
"Other" requests, then I would manually watch the incoming requests,
looking for one that was tagged as "audio/media", and that came from
<code>static.turntable.fm</code>, or <code>fp-limelight.musicnet.com</code>.</p>

<p>I then realized that I could do this much more painfully in Wireshark. I
could watch requests go, packet by packet, and I could then try and save
the packets with audio data and concatenate them somehow, producing a
full audio file. Of course, there was a much simpler way to do this:
Node.js.</p>

<p>Node.js does stream redirection well, and can operate as an HTTP proxy.
It could watch all the http requests flowing in and out of the computer,
scanning each one carefully. I could install my server as the system
proxy, and I'd be able to watch all the requests stream by, and identify
which responses would hold the audio data.</p>

<p>Once I had the idea, implementation was simple. Just watch the request
stream for the important URLs, and redirect the responses (containing
the audio), not only back to the browser but into a file on the hard
drive.</p>

<p>My solution worked perfectly. Occasionally, a song would start playing
and be immediately skipped. This produced a file that, while it had all
the relevant ID3 tags and declared it's length in full, only had a few
seconds of audio. This is essentially unavoidable without completely
reworking the system to capture only download URLs, not to simply
redirect the http stream.</p>

<p>You can find Interceptor <a href="https://github.com/atamis/jockey_interceptor">here</a>.
It contains a more detailed readme, TODO, and the code itself.</p>

<h2 id="extending-interceptor">Extending Interceptor</h2>

<p>The music delivery architecture Turntable.fm uses is pretty simple. Make
HTTP requestion, receive music file. When I started looking around, I
noticed this architecture in quite a few places. For instance,
<a href="http://soundcloud.com/">Soundcloud</a>. Soundcloud serves their sound
files on <code>ak-media.soundcloud.com</code>, and it was trivial to add another
URL source to Interceptor, having already added the 2 Turntable.fm
sources.</p>

<p>While Interceptor obtained all the files Soundcloud sent, I ran into a
small problem. The files sent by Soundcloud didn't have ID3 tags.
Turntable thoughtfully includes ID3 tags in the majority of the songs
they serve but Soundcloud did not. Files intercepted from Soundcloud are
less useful, and can be hard to identify.</p>

<p>However, the principal remains sound (pun not intended). After a cursory
inspection of Grooveshark and Pandora, I believe they may be
susceptible. Spotify, on the other hand, probably isn't. They use a more
advanced P2P, probably binary protocol that Node would have a harder
time intercepting and a harder time interpreting. It would lots more
work, and might not be possible.</p>

<h2 id="problems-intercepting">Problems Intercepting</h2>

<p>My understanding of proxy etiquette is sparse, and there's a good chance
Interceptor doesn't follow the rules. In fact, I know it doesn't.
Dropbox seems unable to sync properly when Interceptor is on and
proxying, and there are occasional hiccups during normal browsing (weird
things like websites failing to load and their URLs duplicating in the
browser address bar.) A little help fixing those things from people who
understand proxies better than I do would be nice.</p>

    <hr>
    <div>
      <time class=entry-date" datetime="2011-11-25 15:12:00 UTC" pubdate="pubdate">Nov 25, 2011</time>

      <ul>
            <li><a href="/tags/node/">node</a></li>
            <li><a href="/tags/code/">code</a></li>
      </ul>
    </div>
  </div>

            <div class="post-author-bottom">
              <div class="post-author-card">

                <div class="post-author-info">
                  <h1 class="site-title"><span class=
                  "byline"><span class="author vcard"><a class=
                  "url fn n" href=
                  "http://atamis.me"
                  title="View all posts by Andrew Amis" rel=
                  "author">Andrew Amis</a></span></span></h1>

                  <h2 class="site-description">Programmer and gamer. I specialize in serverside technologies and "DevOps" tasks.</h2>
                </div>

                <div class="post-published-date">
                  <h2 class="site-published">Published</h2>

                  <h2 class="site-published-date"><a href=
                  "http://independentpublisher.me/2013/welcome/"
                  title="Welcome!" rel="bookmark">
                <time class=entry-date" datetime="2015-02-23 16:28:18 -0800" pubdate="pubdate">Feb 23, 2015</time>

              </a></h2>
                </div>
              </div>
            </div>

        </main>
      </div>
    </div>

    <footer id="colophon" class="site-footer" itemscope="itemscope"
    itemtype="http://schema.org/WPFooter" role="contentinfo">
      <div class="site-info">
        <a href="http://independentpublisher.me" rel="designer"
        title=
        "Independent Publisher: A beautiful reader-focused WordPress theme, for you.">
        Independent Publisher</a> by Raam Dev, modified by Andrew Amis,
        powered by Middleman. Compiled on
        <time class=entry-date" datetime="2015-02-23 16:28:18 -0800" pubdate="pubdate">Feb 23, 2015</time>
.
      </div>
    </footer>
  </div>

  <div style="display:none">
    <div class="grofile-hash-map-a058cfca65a5103e838b1d0ea077ca4b">
    </div>
  </div>
  <!--<script type="text/javascript" src=
  "http://independentpublisher.me/wordpress/wp-content/cache/quick-cache/htmlc/public/independentpublisher-me/a/0/9/e/a/6b970c0de651807845ca2c894977524c-compressor-part.js">
  </script> -->
</body>
</html>

